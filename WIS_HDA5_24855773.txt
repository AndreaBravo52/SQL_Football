-- “5”,Sem 7, Year 4 
-- Exchange Student
-- Andrea Bravo Avila
-- andrea.bravoavila@student.uts.edu.au
-- 24855773
-- Women in sports
-- https://fbref.com/en is the link on which the database is based of. 
-- This database describes the women in professional soccer, in relation to teams, leagues and players. 
-- It contains data for different leagues in the world, and by the season when these leagues are played. 
-- Each league has different teams partaking, and the teams have different players. 
-- Through the seasons these players move between teams and leagues, and the teams change ranks in the league they are playing. 
-- Players are hired into a team to play in a specific position, but could potentially be hired by another team to play in a different position. 
--
-- Football is a team sport, with many national and international leagues, each league has various teams playing in them.
-- These teams change through the seasons as more professional teams begin to rise as the sport grows.
-- Teams consist of players with specific positions, the players change teams through the seasons as well. 




DROP table WIS_SEASON CASCADE;
DROP table WIS_LEAGUE CASCADE;
DROP table WIS_TEAM CASCADE;
DROP table WIS_PARTICIPATE CASCADE;
DROP table WIS_ATHLETE CASCADE;
DROP table WIS_ASSIGNED CASCADE;
DROP table WIS_STAFF CASCADE;

CREATE table WIS_SEASON
(
	seasonYr		integer NOT NULL,
	startDate	TEXT,
	endDate		TEXT,
	CONSTRAINT WIS_SEASONPK PRIMARY KEY (seasonYr),
	CONSTRAINT di_table_season CHECK
		((seasonYr<=2024) AND (seasonYr>=1900))
);


CREATE table WIS_LEAGUE
(
	leagueID		TEXT,
	seasonYr		integer NOT NULL,
	leagueName	TEXT,
	country		TEXT,
	numTeams		integer NOT NULL,
	CONSTRAINT WIS_LEAGUEPK PRIMARY KEY (leagueID, seasonYr),
	CONSTRAINT WIS_LEAGUEFK FOREIGN KEY (seasonYr)
		REFERENCES WIS_SEASON
			ON DELETE CASCADE,
	CONSTRAINT di_table_league_numTeams CHECK
		(numTeams>=2)
);

CREATE table WIS_TEAM
(
	teamID		TEXT,
	teamName		TEXT,
	CONSTRAINT WIS_TEAMPK PRIMARY KEY (teamID)
);

CREATE table WIS_PARTICIPATE
(
	leagueID		TEXT,
	seasonYr		integer NOT NULL,
	teamID		TEXT,
	rank		integer NOT NULL,
	CONSTRAINT WIS_PARTICIPATEPK PRIMARY KEY (leagueID,teamID,seasonYr),
	CONSTRAINT WIS_PARTICIPATEFK FOREIGN KEY (leagueID,seasonYr)
		REFERENCES WIS_LEAGUE
			ON DELETE CASCADE,
	CONSTRAINT WIS_PARTICIPATEFK2 FOREIGN KEY (teamID)
		REFERENCES WIS_TEAM
			ON DELETE CASCADE,
	CONSTRAINT di_table_participate_rank CHECK 
		((rank IS NULL) OR ((rank>0) AND (rank<=20)))
);

CREATE table WIS_ATHLETE
(
	athleteID	TEXT,
	name		TEXT,
	age		integer NOT NULL,
	country		TEXT,
	CONSTRAINT WIS_ATHLETEPK PRIMARY KEY (athleteID),
	CONSTRAINT di_table_athlete_age CHECK
		((age>=15) AND (age<=65))
);

CREATE table WIS_ASSIGNED
(
	athleteID	TEXT,
	teamID		TEXT,
	seasonYr		integer NOT NULL,
	role		TEXT,
	CONSTRAINT WIS_ASSIGNEDPK PRIMARY KEY (athleteID, teamID, seasonYr),
	CONSTRAINT WIS_ASSIGNEDFK FOREIGN KEY (athleteID)
		REFERENCES WIS_ATHLETE
			ON DELETE CASCADE,
	CONSTRAINT WIS_ASSIGNEDFK2 FOREIGN KEY (teamID)
		REFERENCES WIS_TEAM
			ON DELETE CASCADE,
	CONSTRAINT WIS_ASSIGNEDFK3 FOREIGN KEY(seasonYr)
		REFERENCES WIS_SEASON
			ON DELETE CASCADE
);


CREATE table WIS_STAFF
(
	staffID		TEXT,
	teamID		TEXT,
	name		TEXT,
	role		TEXT,
	bossID		TEXT,
	CONSTRAINT WIS_STAFFPK PRIMARY KEY (staffID),
	CONSTRAINT WIS_STAFFFK FOREIGN KEY (teamID)
		REFERENCES WIS_TEAM,
	CONSTRAINT WIS_STAFFSR FOREIGN KEY (bossID)
		REFERENCES WIS_STAFF
			ON DELETE RESTRICT
);

INSERT INTO WIS_SEASON VALUES(2023, 'JAN, 2023', 'Dec, 2023');
INSERT INTO WIS_SEASON VALUES(2022, 'JAN, 2022', 'Dec, 2022');
INSERT INTO WIS_SEASON VALUES(2021, 'JAN, 2021', 'Dec, 2021');
INSERT INTO WIS_SEASON VALUES(2020, 'JAN, 2020', 'Dec, 2020');
INSERT INTO WIS_SEASON VALUES(2019, 'JAN, 2019', 'Dec, 2019');

INSERT INTO WIS_LEAGUE VALUES('NWSL',2023,'National Women Soccer League', 'USA', 12);
INSERT INTO WIS_LEAGUE VALUES('WSL',2023,'Womens Super League', 'England', 12);
INSERT INTO WIS_LEAGUE VALUES('ALW',2022,'A-League Women', 'Australia', 12);
INSERT INTO WIS_LEAGUE VALUES('MX',2022,'Liga MX Femenil', 'Mexico', 18);
INSERT INTO WIS_LEAGUE VALUES('NWSL',2022,'National Women Soccer League', 'USA', 12);
INSERT INTO WIS_LEAGUE VALUES('WSL',2022,'Womens Super League', 'England', 12);
INSERT INTO WIS_LEAGUE VALUES('NWSL',2021,'National Women Soccer League', 'USA', 12);
INSERT INTO WIS_LEAGUE VALUES('WSL',2021,'Womens Super League', 'England', 8);

INSERT INTO WIS_TEAM VALUES('PT1', 'Portland Thorns');
INSERT INTO WIS_TEAM VALUES('CRS', 'Chicago Red Stars');
INSERT INTO WIS_TEAM VALUES('OP1', 'Orlando Pride');
INSERT INTO WIS_TEAM VALUES('SDW', 'San Diego Wave');
INSERT INTO WIS_TEAM VALUES('CH1', 'Chelsea');
INSERT INTO WIS_TEAM VALUES('AR1', 'Arsenal');
INSERT INTO WIS_TEAM VALUES('LP1', 'Liverpool');
INSERT INTO WIS_TEAM VALUES('EV1', 'Everton');
INSERT INTO WIS_TEAM VALUES('SFC', 'Sydney FC');
INSERT INTO WIS_TEAM VALUES('WU1', 'Western United');
INSERT INTO WIS_TEAM VALUES('TF1', 'Tigres');
INSERT INTO WIS_TEAM VALUES('PU1', 'Pumas');

INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2023, 'PT1', 1);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2023, 'CRS', 7);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2023, 'OP1', 11);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2023, 'SDW', 2);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2023, 'CH1', 5);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2023, 'AR1', 7);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2023, 'LP1', 2);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2023, 'EV1', 8);
INSERT INTO WIS_PARTICIPATE VALUES('ALW',2022, 'SFC', 1);
INSERT INTO WIS_PARTICIPATE VALUES('ALW',2022, 'WU1',2);
INSERT INTO WIS_PARTICIPATE VALUES('MX',2022, 'TF1',2);
INSERT INTO WIS_PARTICIPATE VALUES('MX',2022, 'PU1',9);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2022, 'PT1', 2);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2022, 'CRS', 5);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2022, 'OP1', 9);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2022, 'SDW', 1);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2022, 'CH1', 3);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2022, 'AR1', 4);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2022, 'LP1', 1);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2022, 'EV1', 8);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2021, 'PT1', 2);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2021, 'CRS', 1);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2021, 'OP1', 7);
INSERT INTO WIS_PARTICIPATE VALUES('NWSL',2021, 'SDW', 4);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2021, 'CH1', 1);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2021, 'AR1', 3);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2021, 'LP1', 7);
INSERT INTO WIS_PARTICIPATE VALUES('WSL',2021, 'EV1', 11);

INSERT INTO WIS_ATHLETE VALUES('099','Emily Madril',24,'USA');
INSERT INTO WIS_ATHLETE VALUES('086','Yuki Nagasato',36,'Japan');
INSERT INTO WIS_ATHLETE VALUES('256','Steph Catley',29,'Australia');
INSERT INTO WIS_ATHLETE VALUES('243','Alessia Russo',24,'England');
INSERT INTO WIS_ATHLETE VALUES('158','Nathalie Bjorn',26,'Sweden'); 
INSERT INTO WIS_ATHLETE VALUES('364','Lucy Graham',26,'England'); 
INSERT INTO WIS_ATHLETE VALUES('098','Crystal Dunn',31,'USA');
INSERT INTO WIS_ATHLETE VALUES('089','Emily van Egmond',30,'Australia');
INSERT INTO WIS_ATHLETE VALUES('049','Millie Bright',30,'England');
INSERT INTO WIS_ATHLETE VALUES('136','Zecira Musovic',27,'Sweden');

INSERT INTO WIS_ASSIGNED VALUES('098','PT1',2021,'DF');
INSERT INTO WIS_ASSIGNED VALUES('089','SDW',2022,'MF');
INSERT INTO WIS_ASSIGNED VALUES('099','OP1',2022,'DF');
INSERT INTO WIS_ASSIGNED VALUES('086','CRS',2019,'MF,FW');
INSERT INTO WIS_ASSIGNED VALUES('256','AR1',2021,'DF,MF');
INSERT INTO WIS_ASSIGNED VALUES('243','AR1',2023,'FW');
INSERT INTO WIS_ASSIGNED VALUES('158','EV1',2023,'DF');
INSERT INTO WIS_ASSIGNED VALUES('364','EV1',2020,'DF');
INSERT INTO WIS_ASSIGNED VALUES('049','CH1',2019,'DF');
INSERT INTO WIS_ASSIGNED VALUES('136','CH1',2020,'GK');

INSERT INTO WIS_ASSIGNED VALUES('098','PT1',2022,'DF');
INSERT INTO WIS_ASSIGNED VALUES('089','SDW',2023,'MF');
INSERT INTO WIS_ASSIGNED VALUES('099','OP1',2023,'DF');
INSERT INTO WIS_ASSIGNED VALUES('086','CRS',2020,'MF,FW');
INSERT INTO WIS_ASSIGNED VALUES('256','AR1',2022,'DF,MF');
INSERT INTO WIS_ASSIGNED VALUES('364','EV1',2021,'DF');
INSERT INTO WIS_ASSIGNED VALUES('049','CH1',2020,'DF');
INSERT INTO WIS_ASSIGNED VALUES('136','CH1',2021,'GK');

INSERT INTO WIS_ASSIGNED VALUES('098','PT1',2023,'DF');
INSERT INTO WIS_ASSIGNED VALUES('086','CRS',2021,'MF,FW');
INSERT INTO WIS_ASSIGNED VALUES('256','AR1',2023,'DF,MF');
INSERT INTO WIS_ASSIGNED VALUES('364','EV1',2022,'DF');
INSERT INTO WIS_ASSIGNED VALUES('049','CH1',2021,'DF');
INSERT INTO WIS_ASSIGNED VALUES('136','CH1',2022,'GK');

INSERT INTO WIS_ASSIGNED VALUES('086','CRS',2022,'MF,FW');
INSERT INTO WIS_ASSIGNED VALUES('364','EV1',2023,'DF');
INSERT INTO WIS_ASSIGNED VALUES('049','CH1',2022,'DF');
INSERT INTO WIS_ASSIGNED VALUES('136','CH1',2023,'GK');

INSERT INTO WIS_ASSIGNED VALUES('086','CRS',2023,'MF,FW');
INSERT INTO WIS_ASSIGNED VALUES('049','CH1',2023,'DF');

INSERT INTO WIS_STAFF VALUES('7','PT1','Tim Jones','FC Owner');
INSERT INTO WIS_STAFF VALUES('1','PT1','Jane Smith','Head Coach',7);
INSERT INTO WIS_STAFF VALUES('2','PT1','June Doe','Asst Coach','1');
INSERT INTO WIS_STAFF VALUES('5','PT1','Rose Waters','Nutritionist',7);
INSERT INTO WIS_STAFF VALUES('6','PT1','Angel Light','Chef',5);
INSERT INTO WIS_STAFF VALUES('3','CRS','Jill Miller','Head Coach');
INSERT INTO WIS_STAFF VALUES('4','CRS','Jess Muller','Asst Coach','3');

CREATE VIEW TeamPlayers AS Select WIS_ASSIGNED.teamID,teamName, seasonYr,name, role FROM WIS_TEAM, WIS_ASSIGNED,WIS_ATHLETE WHERE WIS_TEAM.teamID=WIS_ASSIGNED.teamID AND WIS_ATHLETE.athleteID=WIS_ASSIGNED.athleteID order by teamID;

--Other queries to try

--Display all defenders from teams that are ranked top 3 of their league
--Select name FROM WIS_ATHLETE natural join WIS_ASSIGNED WHERE role LIKE '%DF%'AND teamID in (Select teamID from WIS_PARTICIPATE WHERE rank<=3);


--Display all teams and the league they are in, for those teams with players who are from Europe
--Select leagueName, teamName from WIS_LEAGUE, WIS_TEAM, WIS_PARTICIPATE WHERE WIS_LEAGUE.leagueID=WIS_PARTICIPATE.leagueID AND WIS_TEAM.teamID=WIS_PARTICIPATE.teamID AND WIS_PARTICIPATE.teamID in (Select teamID FROM WIS_ASSIGNED natural join WIS_ATHLETE WHERE country IN ('England','Sweden'));

--Display all players of the Portland thorns who played in the 2022 season
--Select name from WIS_ASSIGNED Natural join WIS_ATHLETE WHERE teamID='PT1' AND seasonYr=2022;
